<html>
    <head>
       <style>

body {
    margin: 0;
}
path {
    fill: none;
    stroke: red;
    stroke-linejoin: round;
    stroke-width: 1.5px;
}

       </style>
    </head>
    <body>

        <svg></svg>

        <script src='./js/d3.min.js'></script>
        <script src="https://d3js.org/d3-tile.v0.0.min.js"></script>
        <script src="https://d3js.org/topojson.v1.min.js"></script>

        <script>
/*

*/
var width = Math.max(960, window.innerWidth * 0.9),
    height = Math.max(500, window.innerHeight * 0.9);

var projection = d3.geoMercator()
    .scale( 1 / (Math.PI * 2) )
    .translate([0, 0]);

var path = d3.geoPath()
    .projection(projection);

var tile = d3.tile()
    .size([width, height]);

var zoom = d3.zoom()
    .scaleExtent([1 << 20, 1 << 25])
    .on("zoom", zoomed);

var svg = d3.select("svg")
    .attr("width", width)
    .attr("height", height);

var raster = svg.append("g");

var vector = svg.append("g");


var center = projection([-0.023, 51.5183]);



var london = [
"Barking",
"Battersea",
"Beckenham",
"Bermondsey and Old Southwark",
"Bethnal Green and Bow",
"Bexleyheath and Crayford",
"Brent Central",
"Brent North",
"Brentford and Isleworth",
"Bromley and Chislehurst",
"Camberwell and Peckham",
"Carshalton and Wallington",
"Chelsea and Fulham",
"Chingford and Woodford Green",
"Chipping Barnet",
"Cities of London and Westminster",
"Croydon Central",
"Croydon North",
"Croydon South",
"Dagenham and Rainham",
"Dulwich and West Norwood",
"Ealing Central and Acton",
"Ealing North",
"Ealing Southall",
"East Ham",
"Edmonton",
"Eltham",
"Enfield North",
"Enfield Southgate",
"Erith and Thamesmead",
"Feltham and Heston",
"Finchley and Golders Green",
"Greenwich and Woolwich",
"Hackney North and Stoke Newington",
"Hackney South and Shoreditch",
"Hammersmith",
"Hampstead and Kilburn",
"Harrow East",
"Harrow West",
"Hayes and Harlington",
"Hendon",
"Holborn and St Pancras",
"Hornchurch and Upminster",
"Hornsey and Wood Green",
"Ilford North",
"Ilford South",
"Islington North",
"Islington South and Finsbury",
"Kensington",
"Kingston and Surbiton",
"Lewisham Deptford",
"Lewisham East",
"Lewisham West and Penge",
"Leyton and Wanstead",
"Mitcham and Morden",
"Old Bexley and Sidcup",
"Orpington",
"Poplar and Limehouse",
"Putney",
"Richmond Park",
"Romford",
"Ruislip Northwood and Pinner",
"Streatham",
"Sutton and Cheam",
"Tooting",
"Tottenham",
"Twickenham",
"Uxbridge and South Ruislip",
"Vauxhall",
"Walthamstow",
"West Ham",
"Westminster North",
"Wimbledon"];

d3.json("./assets/topo_wpc.json", function(error, uk) {
    if (error) throw error;

    var wards = topojson.feature(uk, uk.objects.wpc).features;

    console.log(wards[1]);

    vector.data(wards).enter()
        .append("path")
        .attr("d", path);
});




svg.call(zoom)
    .call(zoom.transform, d3.zoomIdentity
    .translate(width / 2, height / 2)
    .scale(1 << 20)
    .translate(-center[0], -center[1]));

function zoomed() {
    var transform = d3.event.transform;

    var tiles = tile
        .scale(transform.k)
        .translate([transform.x, transform.y])
        ();

    projection
      .scale(transform.k / (Math.PI * 2))
      .translate([transform.x, transform.y]);

    vector.attr("d", path);

    var image = raster
        .attr("transform", stringify(tiles.scale, tiles.translate))
        .selectAll("image")
        .data(tiles, function(d) { return d; });

    image.exit().remove();

    image.enter().append("image")
        .attr("xlink:href", function(d) { return "https://" + "abc"[d[1] % 3] + ".tile.openstreetmap.org/" + d[2] + "/" + d[0] + "/" + d[1] + ".png"; })
        .attr("x", function(d) { return d[0] * 256; })
        .attr("y", function(d) { return d[1] * 256; })
        .attr("width", 256)
        .attr("height", 256);
}

function stringify(scale, translate) {
  var k = scale / 256, r = scale % 1 ? Number : Math.round;
  return "translate(" + r(translate[0] * scale) + "," + r(translate[1] * scale) + ") scale(" + k + ")";
}

        </script>
    </body>
</html>